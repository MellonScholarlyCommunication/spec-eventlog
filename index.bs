<pre class='metadata'>
Title: Artefact Lifecycle Event Log
Shortname: eventlog
Level: 1
Status: LS
URL: https://mellonscholarlycommunication.github.io/spec-eventlog
Editor: Miel Vander Sande, [meemoo - Flemish Institute for Archives](https://meemoo.be), miel.vandersande@meemoo.be
Editor: Patrick Hochstenbach, [IDLab - Ghent University](https://knows.idlab.ugent.be), patrick.hochstenbach@ugent.be
Editor: Ruben Dedecker, [IDLab - Ghent University](https://knows.idlab.ugent.be), ruben.dedecker@ugent.be
Editor: Jeroen Werbrouck, [IDLab - Ghent University](https://knows.idlab.ugent.be), Jeroen.Werbrouck@ugent.be
Abstract: This document specifies the requirements for implementing and hosting an Artefact Lifecycle Event Log.
Markup Shorthands: markdown yes
</pre>

<style>
table {
  margin: 25px auto;
  border-collapse: collapse;
  border: 1px solid #eee;
  border-bottom: 2px solid #005A9C;
}
table tr:hover {
  background: #f4f4f4;
}
table tr:hover td {
  color: #555;
}
table th, table td {
  color: #999;
  border: 1px solid #eee;
  padding: 12px 12px;
  border-collapse: collapse;
}
table th {
  background: #005A9C;
  color: #fff;
}
table th.last {
  border-right: none;
}
</style>

Set of documents {#set}
=======================

This document is one of the specifications produced by the **ResearcherPod** and **ErfgoedPod** project:

1. [Overview](/spec-overview/)
2. [Orchestrator](/spec-orchestrator/) 
3. [Data Pod](/spec-datapod/)
4. [Rule language](/spec-rulelanguage/)
5. [Artefact Lifecycle Event Log](/spec-eventlog/) (this document)
6. [Notifications](/spec-notifications/)
7. [Collector](/spec-collector/)

Introduction {#intro}
=====================
In a decentralized network,
an artefact can be shared between actors and processed by a multitude of services,
each appending to the artefact's lifecycle.
For each artefact, a series of lifecycle events is therrefore distributed over the network.
This document introduces the [=Artefact Lifecycle Event Log=], 
a data format and protocol for the recording and discovery of these events,
in order to serve mostly applications related to network governance.

An [=Artefact Lifecycle Event Log=] is an artefact-centric, append-only, public Web resource that exposes a series of lifecycle events.
To ensure network-wide interoperability, events are recorded using a data vocabulary encoded in [[rdf11-concepts|RDF]].
In most common cases, 
the [=Artefact Lifecycle Event Log=] is an [[LDP]] Resource that is part of a [[solid-protocol#data-pod| Solid Data Pod]].
This document describes

- a data vocabulary compatible with [[prov-o|PROV-O]] and [[activitystreams-vocabulary|Activity Streams 2.0]] for describing lifecycle event and log information;
- the Web resource definition of the [=Artefact Lifecycle Event Log=];
- the creation and linking process;
- the addition, discovery and retrieval process for Event information in the log.

# Document Conventions # {#conventions}

Within this document, the following namespace prefix bindings are used: 

<table>
<thead>
<tr>
	<th>Prefix
	<th>Namespace
<tbody>
<tr>
	<td>as
	<td>https://www.w3.org/ns/activitystreams#
<tr>
	<td>daen
	<td>http://www.w3.org/ns/solid/daen#
<tr>
	<td>ldp
	<td>http://www.w3.org/ns/ldp#
<tr>
	<td>prov
	<td>http://www.w3.org/ns/prov#
<tr>
	<td>dcat
	<td>http://www.w3.org/ns/dcat#
<tr>
	<td>ldes
	<td>https://w3id.org/ldes#
<tr>
	<td>st
	<td>http://www.w3.org/ns/st#
<tr>
	<td>acl
	<td>http://www.w3.org/ns/auth/acl#
<tr>
	<td>hydra
	<td>http://www.w3.org/ns/hydra/core#
</table>

Note: All required URIs for any term that currently has no namespace are defined as: <code>https://ournamespace.org/&lt;TERM&gt;</code>

Applications of the Artefact Lifecycle Event Log
================================================

A [=Decentralized Artefact Exchange Network=] can support communities in the exchange of digital artefacts and services without the need of a central authority.
Data about these exchanges is therefore distributed over every actor in the network.
This intensifies an actor's control over its data and severly reduces data duplication, 
but also makes it more difficult to get a clear picture about an artefact's history.
There is no longer a single go-to trusted authority that records and certifies who applied what services to an artefact and when.
In a [=Decentralized Artefact Exchange Network=], 
this information needs to be collected from different actors with varying levels of trust.
The [=Artefact Lifecycle Event Log=] provides basic groundwork for publishing artefact lifecycles and thus supporting this collection process. 

In short,
an [=Artefact Lifecycle Event Log=] registers lifecycle events that the [=Decentralized Artefact Exchange Network=] instance desires to be to be publicly disclosed.
This is determined by the nature of the network, the use cases it supports, and how lifecycle information is employed.
Typically, a network instance requires these events to be common knowledge to guarentee its well-functioning. 
For instance, a food network might desire the publication of a completed health inspection process.
It is therefore assumed that the dominant fraction of participating actors will experience sufficient incentive to host a [=Decentralized Artefact Exchange Network=] available to all actors in the network; and accurately record the selected lifecycle events.
This pragmatic approach is needed because no decentralized design can force actors to comply,
while maintaining truly scalable.

This document offers a minimal semantic data model to construct and publish artefact lifecycle events, which serves as a basis for technical interoperability, 
It is expected that a community that employs an instance of a [=Decentralized Artefact Exchange Network=], extends this model with domain-specific event types that provide more meaning and understanding within the network instance.
A community can also leverage lifecycle information as they see fit, resulting in one or more applications of the [=Artefact Lifecycle Event Logs=].
Some probable applications are given below: 

## Establishing trust in the integrity of an artefact

In some domains, 
an artefact's value depends on its reconstructed lifecycle and whether this lifecycle can be trusted.
For instance, 
in scholarly communication, 
a publication gains status after it has been certified by a certification service (eg. by a peer review process).
Such lifecycle event should be registered in the [=Artefact Lifecycle Event Logs=] of both parties.
When reconstructing the artefact's lifecycle to assess its integrity, 
encountering such events in multiple places increases the trust.

## Discovering entities on the network

A process that collects decentralized information needs a way to navigate the network and discover new artefacts.
Given the potential size of the network, 
many data pods are still unknown when this process starts.
Discovering unknown pods relies on existing links between actors and artefacts.
Therefore, an [=Artefact Lifecycle Event Log=] can be used to find these links and serve as a routing mechanism.
For instance, 
in a digital heritage network,
a portal wants to discover relevant data stored in pods controlled by cultural heritage institutions.
No knowing the location of these pods beforehand, the portal might consult the eventlog of a registry service hub first, to finds links to all datasets that were registered there.

Overview {#overview}
=================================
A [=Artefact Lifecycle Event Log=] is a Web resource that is accessible by all actors inside a single network.
When requested, it returns an ordered list of notable lifecycle events descriptions, each containing the what, who and when of the event. 
An actor can store new descriptions by updating this resource.
The log maintains a chronological order; new events are appended to the end of the log.
Hence, it MUST support producers appending events as described in [[#producing]].
It MAY also validate [=Lifecycle Events=] before they are added in accordance to [[#validation]].

An [=Artefact Lifecycle Event Log=] MUST be consumable for authorized actors in the network in accordance to [[#consuming]].
Its URL MUST be discoverable through one of the methods described in [[#discovery]].
Actors in the network MAY be authorized to read, append or change the permissions according to the authorization mechanism in [[#authorization]]. 
Lifecycle events MUST be described in the artefact lifecycle data vocabulary as defined in [[#vocabulary]].
An [=Artefact Lifecycle Event Log=] MUST be available in the [[turtle]] format, 
but it MAY support other data formats as well through content negotiation.

While not mandatory, each actor in the network is expected to host a [=Artefact Lifecycle Event Log=] resource per known artefact to allow effective network governance.
As a result, a single [=Artefact Lifecycle Event Log=] MUST correspond to at least one [=artefact=] in the network, 
while an [=artefact=] MAY correspond to multiple [=Artefact Lifecycle Event Logs=].

<figure>
	<img src="images/logs.png" width="100%" />
	<figcaption>
	Alice and Bob have data pods that contain two resources: an artefact and an Artefact Lifecycle Event Log. 
	Service Hubs also host a Artefact Lifecycle Event Log resource. 
	Since Service Hub B certifies artefacts, the lifecycle event that Alice's artefact A has been certified is in the logs of both Alice and Service Hub B.
	Also, Bob made a comment on Alice's Artefact B, hence both actor's logs contain the lifecycle event that artefact A has been commented on by Bob.
	</figcaption>
</figure>

Vocabulary {#vocabulary}
=================================

An [=Artefact Lifecycle Event Log=] can be described using a minimal data vocabulary, 
introducing a number of high level semantic types and properties.
The <dfn>Artefact Lifecycle Event Vocabulary</dfn> can be used to construct an [[rdf-primer|RDF 1.1]] representation of the log and the lifecycle events it contains.
The data vocabulary is fully compatible with [[prov-o|PROV-O]] and the object types from [[activitystreams-vocabulary|Activity Streams 2.0]].
An overview is given in the figure below.

<figure>
	<img src="images/classes.svg" width="100%" />
	<figcaption>
	A diagram of the Artefact Lifecycle Event Vocabulary
	</figcaption>
</figure>

## Types

The following table lists the [=Artefact Lifecycle Event Vocabulary=] types.
These semantic types that distinguish the different resources and actors that are involved in an artefact's lifecycle. 

: Base URI: 
:: `http://www.w3.org/ns/solid/daen#`
: Preferred prefix: 
:: `daen`
: Classes: 
:: <a href="#type-artefact">daen:Artefact</a> | <a href="#type-lifecycle-event">daen:LifecycleEvent</a> | <a href="#type-lifecycle-event-log">daen:ArtefactLifecycleEventLog</a> | <a href="#type-maintainer">daen:Maintainer</a> | <a href="#type-service-hub">daen:ServiceHub</a>

### Type: <a href="http://www.w3.org/ns/solid/daen#Artefact">daen:Artefact</a> ### {#type-artefact}

**URI:** http://www.w3.org/ns/solid/daen#Artefact

A Web resource and [[spec-overview#artefact|Artefact]] that is the object of interaction between [=actors=] and retains a lifecycle within the network.

**Example:**

<pre class=include-code>
path: examples/Artefact.ttl
highlight: turtle
show: 
</pre>

: Subclass of:
:: <a href="https://www.w3.org/ns/activitystreams#Object">as:Object</a>, <a href="https://www.w3.org/TR/prov-o/#Entity">prov:Entity</a>
: Properties:
:: <a href="">daen:eventLog</a> 


### Type: <a href="http://www.w3.org/ns/solid/daen#LifecycleEvent">daen:LifecycleEvent</a> ### {#type-lifecycle-event}

**URI:** `http://www.w3.org/ns/solid/daen#LifecycleEvent`

A [[spec-overview#artefact-lifecycle-event|Artefact Lifecycle Event]] that impacted the lifecycle of a certain [[spec-overview#artefact|Artefact]] and is of value to the well-functioning of the network. 
They often result from an [=actor=] performing a service pertaining to that [[spec-overview#artefact|Artefact]]. 

**Example:**

<pre class=include-code>
path: examples/LifecycleEvent.ttl
highlight: turtle
show: 
</pre>

: Subclass of:
:: <a href="https://www.w3.org/TR/prov-o/#Activity">prov:Activity</a>
: Properties:
:: <a href="">daen:executor</a>, <a href="">daen:artefact</a>

### Type: <a href="http://www.w3.org/ns/solid/daen#ArtefactLifecycleEventLog">daen:ArtefactLifecycleEventLog</a> ### {#type-lifecycle-event-log}

**URI:** `http://www.w3.org/ns/solid/daen#ArtefactLifecycleEventLog`

A Web resource and [[spec-overview#artefact-lifecycle-event-log|Artefact Lifecycle Event Log]] that exposes an ordered collection of [[spec-overview#artefact-lifecycle-event|Artefact Lifecycle Events]] resources that pertain to certain [[spec-overview#artefact|Artefact]].

**Example:**

<pre class=include-code>
path: examples/ArtefactLifecycleEventLog.ttl
highlight: turtle
show: 
</pre>

: Subclass of:
:: 
: Properties:
:: <a href="">daen:isEventLogOf</a>, <a href="">ldp:contains</a>, <a href="">daen:maintainer</a>

### Type: <a href="http://www.w3.org/ns/solid/daen#Maintainer">daen:Maintainer</a>  ### {#type-maintainer}

**URI:** `http://www.w3.org/ns/solid/daen#Maintainer`

A [[spec-overview#actor|Actor]], [[spec-overview#maintainer|Maintainer]] and [[spec-overview#human-agent|Human Agent]] that participates on the network and generates activities pertaining to the lifecycle of an [[spec-overview#artefact|Artefact]].

**Example:**

<pre class=include-code>
path: examples/Maintainer.ttl
highlight: turtle
show: 
</pre>

: Subclass of:
:: <a href="https://www.w3.org/TR/prov-o/#Agent">prov:Agent</a>, <a href="https://www.w3.org/ns/activitystreams#Person">as:Person</a>, <a href="https://www.w3.org/ns/activitystreams#Organization">as:Organization</a>
: Properties:
::

### Type: <a href="http://www.w3.org/ns/solid/daen#ServiceHub">daen:ServiceHub</a> ### {#type-service-hub}

**URI:** `http://www.w3.org/ns/solid/daen#ServiceHub`

A [[spec-overview#actor|Actor]] and [[spec-overview#service-hub|Service Hub]] that performs services pertaining to the lifecycle of an [[spec-overview#artefact|Artefact]].

**Example:**

<pre class=include-code>
path: examples/ServiceHub.ttl
highlight: turtle
show: 
</pre>

: Subclass of:
:: <a href="https://www.w3.org/TR/prov-o/#Agent">prov:Agent</a>, <a href="https://www.w3.org/ns/activitystreams#Service">as:Service</a>, <a href="http://www.w3.org/ns/dcat#DataService">dcat:DataService</a>
: Properties:
::

## Properties

The following table lists the [=Artefact Lifecycle Event Vocabulary=] properties.
These describe the relationship between the different resources and actors that are involved in an artefact's lifecycle.

<figure>
	<img src="images/model.svg" width="100%" />
	<figcaption>
	A diagram of the Artefact Lifecycle Event Vocabulary
	</figcaption>
</figure>

: Base URI: 
:: `http://www.w3.org/ns/solid/daen#`
: Preferred prefix: 
:: `daen`
: Properties: 
:: <a href="">daen:eventLog</a> | <a href="">daen:isEventLogOf</a> | <a href="">daen:artefact</a> | <a href="">daen:maintainer</a> | <a href="">daen:executor</a>
: External properties: 
:: <a href="">ldp:contains</a> | <a href="">prov:contains</a>

### Property: <a href="">daen:eventLog</a>

**URI:** `http://www.w3.org/ns/solid/daen#eventLog`

The [[spec-overview#artefact-lifecycle-event-log|Artefact Lifecycle Event Log]] that represents the lifecycle of an [[spec-overview#artefact|Artefact]].

: Subproperty of:
:: 
: In domain:
:: <a href="">daen:Artefact</a>
: In range:
:: <a href="">daen:ArtefactLifecycleEventLog</a>

### Property: <a href="">daen:isEventLogOf</a>

**URI:** `http://www.w3.org/ns/solid/daen#isEventLogOf`

The [[spec-overview#artefact|Artefact]] which lifecycle is represented by t[[spec-overview#artefact-lifecycle-event-log|Artefact Lifecycle Event Log]] of this .

: Subproperty of:
:: 
: In domain:
:: <a href="">daen:ArtefactLifecycleEventLog</a>
: In range:
:: <a href="">daen:Artefact</a>

### Property: <a href="">daen:artefact</a>

**URI:** `http://www.w3.org/ns/solid/daen#artefact`

The artefact whose lifecycle the [[spec-overview#lifecycle-event|Lifecycle Event]] belongs to.

: Subproperty of:
:: 
: In domain:
:: <a href="">daen:LifecycleEvent</a>
: In range:
:: <a href="">daen:Artefact</a>

### Property: <a href="">daen:maintainer</a>

**URI:** `http://www.w3.org/ns/solid/daen#maintainer`

The [[spec-overview#maintainer|Maintainer]] who maintains the [[spec-overview#artefact-lifecycle-event-log|Artefact Lifecycle Event Log]] resource.

: Subproperty of:
:: <a href="">prov:</a>
: In domain:
:: <a href="">daen:ArtefactLifecycleEventLog</a>
: In range:
:: <a href="">daen:Maintainer</a>

### Property: <a href="">daen:executor</a>

**URI:** `http://www.w3.org/ns/solid/daen#executor`

The [[spec-overview#maintainer|Maintainer]] or [[spec-overview#service-hub|Service Hub]] who executed the event.

: Subproperty of:
:: <a href="">prov:</a>
: In domain:
:: <a href="">daen:LifecycleEvent</a>
: In range:
:: <a href="">daen:Maintainer</a> | <a href="">daen:ServiceHub</a>

### External properties

<table>
<tr>
	<td><a href="">ldp:contains</a>
	<td>`http://www.w3.org/ns/ldp#contains`
	<td>The [[spec-overview#lifecycle-event|Lifecycle Event]] that is contained by this [[spec-overview#artefact-lifecycle-event-log|Artefact Lifecycle Event Log]].
	<td><a href="">daen:ArtefactLifecycleEventLog</a>
	<td><a href="">daen:LifecycleEvent</a>
<tr>
	<td><a href="">prov:generated</a>
	<td>`http://www.w3.org/ns/prov#generated`
	<td>An secondary [[spec-overview#artefact|Artefact]] that resulted from this [[spec-overview#lifecycle-event|Lifecycle Event]]. 
	<td><a href="">daen:LifecycleEvent</a>
	<td><a href="">daen:Artefact</a>

<tr>
	<td><a href="">prov:startedAtTime</a>
	<td>`http://www.w3.org/ns/prov#startedAtTime`
	<td>The moment the [[spec-overview#lifecycle-event|Lifecycle Event]] started.
	<td><a href="">daen:LifecycleEvent</a>
	<td><a href="http://www.w3.org/2001/XMLSchema#dateTime">xsd:dateTime</a>
<tr>
	<td><a href="">prov:endedAtTime</a>
	<td>`http://www.w3.org/ns/prov#endedAtTime`
	<td>The moment the [[spec-overview#lifecycle-event|Lifecycle Event]] ended.
	<td><a href="">daen:LifecycleEvent</a>
	<td><a href="http://www.w3.org/2001/XMLSchema#dateTime">xsd:dateTime</a>

<tr>
	<td><a href="">dct:title</a>
	<td>`http://purl.org/dc/terms/title`
	<td>The title of the [[spec-overview#lifecycle-event|Lifecycle Event]].
	<td><a href="">daen:LifecycleEvent</a> | <a href="">daen:ArtefactLifecycleEventLog</a>
	<td><a href="http://www.w3.org/2001/XMLSchema#string">xsd:string</a>

</table>


<div class='example'>

<pre class=include-code>
path: examples/basic.ttl
highlight: turtle
show: 
</pre>

</div>


Discovering an Artefact Lifecycle Event Log {#discovery}
===============================

An [=Artefact Lifecycle Event Log=] resource can be discovered with multiple methods:

1. [=Actors=] issue a request to any resource to retrieve the [=Artefact Lifecycle Event Log=]'s URL from a link ([[#discovery-link]]).
2. [=Actors=] use [[shapetrees]] description to pinpoint the [=Artefact Lifecycle Event Log=]'s URL ([[#discovery-shapetrees]])  

Issue: how to pinpoint what resources can lead to such link? Who is hosting them? 

Any [=artefact=] resource MUST support the first discovery method. They MAY support the additional [[shapetrees]] method.
[=Actors=] MAY choose the order in which they try these discovery methods

## Discovery via link ## {#discovery-link}

An [=actor=] MUST try at least one of the following:

 - make an HTTP HEAD or GET request on the target URL, and use the `Link` header with a `rel` value of `http://www.w3.org/ns/solid/daen#eventLog`.
 - make an HTTP GET request on the target URL to retrieve an [[rdf11-primer|RDF 1.1]] representation, whose encoded RDF graph contains a relation of type `http://www.w3.org/ns/solid/daen#eventLog`. The subject of that relation is the target and the object is the [=Artefact Lifecycle Event Log=].
 - make an HTTP GET request on the target URL to retrieve an [[html]] representation, whose HTML body contains a link element with a rel value of `http://www.w3.org/ns/solid/daen#eventLog`. The value of the `href` attribute is the [=Artefact Lifecycle Event Log=].

An [=actor=] may be carried out in either order, but if the one fails to result in an [=Artefact Lifecycle Event Log=] the alternatives MUST be tried. 
A resource MAY advertise multiple [=Artefact Lifecycle Event Log=] resources, for example an [=artefact=] aiding in the discovery of its lifecycle distributed over the network. A [=Artefact Lifecycle Event Log=] MAY be used by multiple resources, for example using a single [=Artefact Lifecycle Event Log=] to collect the [=Lifecycle Events=] from all [=Artefacts=] in a data pod.

<div class='example'>
In case of an RDF resource located at `resourceURI`, any implementation linking an Event Log located at `eventLogURI` through an in-body link MUST add the following data triple to the document body:

``` turtle
@prefix daen: <http://www.w3.org/ns/solid/daen#> . 

<resourceURI> daen:eventLog <eventLogURI>.
```
</div>

<div class='example'>
In case of an HTML resource located at `resourceURI`, any implementation linking an Event Log located at `eventLogURI` through an in-body link MUST add use a Link element in the HTML body as follows:
``` html
	<link href="http://www.w3.org/ns/solid/daen#eventLog" rel="eventlog" />;
```
</div>

<div class='example'>
Any resource with a linked Event Log that does not advertise this Event Log through an in-body link MUST advertise this Event Log through a Link header in the server response as follows: 
```
	Link: </EventLog>; rel="http://www.w3.org/ns/solid/daen#eventLog".
```
</div>

Issue: get more specifics on the method below

Certain data formats may use an external resource to aggregate metadata and/or serve as an entrypoint for multiple resources.
The implementer MAY choose to aggregate the [=Artefact Lifecycle Event Log=] entities advertised by the aggregated resources in the aggregation resource, 
and advertise them from this resource.
Alternatively, the implementer may choose to advertise a single [=Artefact Lifecycle Event Log=] instance from the aggregation resource for all aggregated resources. 

Any implementation MAY support the discovery of an Event Log through an external resource.
In this case, the actor MUST make an HTTP HEAD or GET request on the target URL.
The actor must search in the response headers for a Link header with a `rel` value of `meta` and in the response body for a link element with a rel value of `meta` in the case of a [[html]] representation, 
or for a data triple with a predicate value of `rdf:seeAlso` in case of an [[rdf11-primer|RDF 1.1]] encoding.

<div class='example'>
The aggregation resource located at `aggregationResourceURI` MUST be linked for all aggregated resources through EITHER an in-body link of the form:

``` html
<link rel='meta' href='{aggregationResourceURI}' />
``` 
in case of a HTML resource and 

``` turtle
<resourceURI> rdf:seeAlso <aggregationResourceURI> .
``` 
in case of an RDF encoding OR using a `Link` header of the form:

``` http
Link: &lt;aggregationResourceURI&gt;; rel=meta
```

## Discovery via Shape Trees ## {#discovery-shapetrees}
Any implementation MAY support the discovery of an [=Artefact Lifecycle Event Log=] through [[shapetrees]]  defined in the data platform.

In the [[solid-protocol|Solid]] ecosystem, All created Event Log SHOULD be discoverable in the data pod through the pod's [[shapetrees#tree|Shape Tree]].
This enables actors in the network to efficiently aggregate all [=Lifecycle Event=] data in the data pod for which they have Read permissions.

<div class="example">
```
// The Events folder contains EventLog containers
<#Events> st:expectsType st:ShapeTreeContainer ;
	st:contains <#EventStream> ; 

// An Event Log is a container in the Solid ecosystem containing Event resources.
<#EventStream> tree:expectsType st:ShapeTreeContainer ;
	st:contains <#Event> ;
	
// An Event resource is Validated by a base Event shape
<#Event> tree:expectsType st:ShapeTreeResource ;
	st:validatedBy <EventShape> ;

<EventShape> { ... }
```
</div>


Appending to an Event Log {#producing}
======================================
To find the Event Log URI for a resource, an actor must first go through the [discovery](#discovery) step.
On discovery of an Event Log URI, the actor can start appending to the Event Log.
To append an event to the Event Log, the actor MUST send a POST request to the Event Log URI.
In case [authorization](#authorization) is enabled for the Event Log, the actor MUST have [append permissions](#authorization-append) to execute this action.

Before appending an event to the Event Log, the client SHOULD try to discover if [validation](#validation) is enabled for the Event Log. In case validation is enabled, the client SHOULD try to validate the event first on the client with the discovered validation link. 

Any event that is successfully posted and validated MUST be added to the Event Log.
The permissions for the event SHOULD per default be inherited from the Event Log permissions.

On a successful POST request, the event MUST be added on a URI <em>eventURI</em> and MUST be defined in the body of its Event Log with URI <em>eventLogURI</em> using an RDF triple of the form:
<pre>
	&lt;eventLogURI&gt; ldp:contains &lt;eventURI&gt; .
</pre>

## Pagination ## {#producing-pagination}
The Event Log MAY make use of pagination.
Any used pagination system MUST make sure that ALL events in the Event Log can be retrieved by following the available <em>next</em> links.
These links MUST be provided either as a Link header of the form:
<pre>
	Link: &lt;nextPageLocation&gt;; rel="next"
</pre>
or in the body of the Event Log / a retrieved page of the Event Log as a data triple:
<pre>
	&lt;eventLogURI&gt; hydra:next &lt;nextPageLocation&gt; .
</pre>
Any implementation MAY provide additional pagination support or filtering possibilities, and SHOULD advertise these using the appropriate mechanisms detailed by their specifications. 


Consuming an Event Log {#consuming}
===================================
First any actor wishing to consume the Events linked to a resource MUST discover any Event Log linked to the resource accoring to [](#discovery).
On discovery of an Event Log URI, the actor MUST make a GET request to the Event Log URI with a Content-Type header of the form:
<pre>
Accept: text/turtle
</pre>
On a succesful GET request on the Event Log URI <code>eventLogURI</code>, the actor can discover the URIs of the available events by processing the Event Log body for all data triples of the form:
<pre>
	&lt;eventLogURI&gt; ldp:contains &lt;eventURI&gt; .
</pre>
The consumer implementation MAY include alternate approaches to retrieving events from an Event Log, but MUST support this retrieval method.


## Pagination ## {#consuming-pagination}
Any consumer implementation MUST support pagination through following advertised <em>next</em> links.
On a GET request to an Event Log / Event Log page on URI <code>eventLogPageURI</code> with an Accept header of type <code>text/turtle</code>, the consumer MUST process the server response for a Link header with a rel value of <code>"next"</code>.
The response body MUST be processed to discover any data triples of the form:
<pre>
	&lt;eventLogPageURI&gt; hydra:next &lt;nextPageLocation&gt; .
</pre>
Any implementation MAY support additional advertised pagination or filtering approaches, but MUST support this approach for consuming a paginated Event Log.


Authorization {#authorization}
===============================
Any platform implementing the Event Log mechanism MAY support authorization for the following aspects of the Event Log mechanism:
- Reading access for an Event Log
- Append access for an Event Log
- Update permissions for an Event Log
- Reading access for a specific event in an Event Log
- Update permissions for a specific event in an Event Log

Any implementation of authorization for an Event Log MUST make use of [Web Access Control (WAC)](https://www.w3.org/wiki/WebAccessControl). 
The discovery of the ACL document for a resource MUST be done according to the [ACL spec](https://www.w3.org/wiki/WebAccessControl).
The setting of permissions for a resource happens by creating / updating the [ACL file](https://www.w3.org/wiki/WebAccessControl) for that resource.

NOTE: Depending of the course of the Solid Project, this dependency on WAC may be updated to include newer approaches to auhtorization, as the goal is to maintain compatibility with the Solid Project.

## Read authorization ## {#authorization-read}
Any actor with Read permissions set for an Event Log MUST be able to discover all Events in the Event Log to which the actor has Read permissions.
Any actor with Read permissions set for an Event Log SHOULD automatically have read permission for all the stored events, UNLESS explicitly defined otherwise by the individual events.
The implementation MAY restrict the actor from discovering events in the Event Log for which the actor does not have Read permissions.
Any actor without Read permissions for an Event Log SHOULD NOT be able to discover the Event in the Event Log, even if the actor has Read permissions for individual events in the Event Log.

## Append authorization  ## {#authorization-append}
Any actor with Append permissions set for an Event Log MUST be able to append Events to the Event Log.

Note: The implementation MAY decide to use EITHER acl:Write OR acl:Append as the permission to append events to the Event Log, but the platform MUST support the use of POST operations on the Event Log for the chosen permission.


## Update permissions authorization  ## {#authorization-permissions}
Any actor with Update permissions set for an Event Log MUST be able to edit permissions for all actors for the Event Log.
Any actor with Update permissions set for an Event Log MUST be able to edit permissions for all individual events in the Event Log UNLESS explicitly defined otherwise by the individual events.

## Event specific read authorization  ## {#authorization-specific-read}
Any actor with Read permissions set for an event MUST be able to read this event, and discover the event in the Event Log in the case of Read permissions for the Event Log.

## Event specific update permissions authorization  ## {#authorization-specific-update}
Any actor with Update permissions set for an event MUST be able edit permissions for all actors for this event.

Validation {#validation}
===============================
Any implementation of the Event Log mechanism MAY add support for validating events that are appended to the Event Log.
In case an actor tries to append an event to the Event Log that cannot be validated, the event MUST NOT be added to the Event Log and an appropriate 4xx error code must be returned.
The following sections define the different possibilities for providing a shape file, located at <code>shapeFileLocation</code>, to which an event MUST validate before it can be added to the Event Log.
If a shape file is advertised using any of the different methods described in the following sections, the server MUST validate all incoming requests to append an event to the Event Log and MUST reject all requests for which the event fails this validation step.

## Validation Link Header ## {#validation-link-header}
A request to the Event Log MAY return the following Link header:
<pre>
	Link: &lt;shapeFileLocation&gt;; rel=http://www.w3.org/ns/ldp#constrainedBy
</pre>
In this case, the server MUST validate all incoming requests to append an event to the Event Log for the advertised shape file.


## Validation in-body Link ## {#validation-in-body-link}
The Event Log MAY provide the following links in the resource body:
<pre>
	&lt;link rel='http://www.w3.org/ns/ldp#constrainedBy' href='&lt;shapeFileLocation&gt;'/&gt;
</pre>
in the case of an HTML resource, and 
<pre>
	&lt;eventLogURI&gt; &lt;http://www.w3.org/ns/ldp#constrainedBy&gt; &lt;shapeFileLocation&gt;.
</pre>
in case of an RDF resource.
In this case, the server MUST validate all incoming requests to append an event to the Event Log for the advertised shape file.
http://www.w3.org/ns/ldp#constrainedBy

## Shape Tree Validation ## {#validation-shape-tree}
In a Solid environment, the shape file to which all events in the Event Log must validate MAY be advertised using a st:validatedBy link in the [Shape Tree](https://shapetrees.org/).
In this case, the implementation SHOULD also advertise this shape file using EITHER [a link header](#validation-link-header) or [an in-body link](#validation-in-body-link).
<div class="example">
```

// An Event Log is a container in the Solid ecosystem containing Event resources.
<#EventStream> tree:expectsType st:ShapeTreeContainer ;
	st:contains <#Event> ;
	
// All event resources MUST validate for the advertised shape
<#Event> tree:expectsType st:ShapeTreeResource ;
	st:validatedBy <shapeFileLocation> ;
```
</div>


Issue: move section below to new document?

Implementation {#implementation}
========================
In this section, we provide implementation examples 

## Linked Data Event Streams and the Solid Platform ## {#implementation-solid}


An Event Log is defined as a [Linked Data Event Stream (LDES)](https://semiceu.github.io/LinkedDataEventStreams/eventstreams.html), a collection of immutable objects, each object being described using a set of RDF triples.

<div class="example">
<u><b>/EventLog</b></u>
```
<> a ldes:EventStream ;
	tree:shape <EventShape.shacl> ; 
	tree:member </Events/1>, </Events/2>, ... ;
	tree:view <?page=1> .

<#node> a tree:Node ;
    tree:relation [
        a tree:GreaterThanOrEqualToRelation ;
        tree:path dct:issued ;
        tree:node </pages/1#node> ;
        tree:value "2020-10-10T10:00:00Z"^^xsd:dateTime
     ] .
```
<hr>
<u><b>/pages/1</b></u>
```
</EventLog> a ldes:EventStream ;
	tree:shape <EventShape.shacl> ; 
	tree:member </Events/3>, </Events/4>, ... ;

<#node> a tree:Node ;
	void:subset </EventLog>;
```
</div>

Note: This example shows the Event Log as a Linked Data Event Stream, ordered according to the <code>dct:issued</code> value of the Events.



<img alt="…" src="images/peer_review_sequence.svg" style="width: 100%">

<img alt="…" src="images/review_aftermath.svg" style="width: 100%">



Spec roadmap {#roadmap}
====================================
## September ## {#september}
1. Work out full implementation details
	- target the Solid ecosystem
	- using the Event Streams Spec
	- update images of control flows (outdated)

2. Better definitions for minimal-requirements (do you need a full Solid implementation?) - low priority




<pre class=biblio>
{
	"solid-oidc": {
		"authors": [
			"Aaron Coburn (Inrupt)",
			"elf Pavlik",
			"Dmitri Zagidulin"
		],
		"href": "https://solid.github.io/authentication-panel/solid-oidc/",
		"title": "SOLID-OIDC",
		"status": "Editor’s Draft",
		"publisher": "Solid project",
		"deliveredBy": [
			"https://www.w3.org/community/solid/"
		]
	},
	"solid-protocol": {
		"authors": [
			"Sarven Capadisli",
			"Tim Berners-Lee",
			"Ruben Verborgh",
			"Kjetil Kjernsmo",
			"Justin Bingham",
			"Dmitri Zagidulin"
		],
		"href": "https://solidproject.org/TR/protocol",
		"title": "The Solid Protocol",
		"status": "Editor’s Draft",
		"publisher": "Solid project",
		"deliveredBy": [
			"https://www.w3.org/community/solid/"
		]
	},
    "spec-overview": {
		"authors": [
      "Miel Vander Sande",
      "Patrick Hochstenbach",
      "Ruben Dedecker",
      "Jeroen Werbrouck"
    ],
		"href": "http://mellonscholarlycommunication.github.io/spec-overview/",
		"title": "Overview of the ResearcherPod specifications",
		"status": "Editor’s Draft",
		"publisher": "ResearcherPod project"
	},
	"shapetrees": {
		"authors": [
			"Eric Prud'hommeaux", 
			"Justin Bingham"
		],
		"href": "https://shapetrees.org/TR/specification/",
		"title": "Shape Trees Specification",
		"status": "Editor’s Draft",
		"publisher": "Solid project",
		"deliveredBy": [
			"https://www.w3.org/community/solid/"
		]
	}
}
</pre>

# Acknowledgement

We thank Herbert Van de Sompel, [DANS + Ghent University](https://dans.knaw.nl/nl/), hvdsomp@gmail.com
for the valuable input during this project.